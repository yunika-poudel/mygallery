"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7438],{32471:function(e,t,n){n.d(t,{_:function(){return r}}),n(19401),n(63807),n(26873);var r="_1c6tscn1 _1286nb1202 _1286nb11le _1286nb11ak _1286nb11p8 _1286nb139q _1286nb13h2"},67310:function(e,t,n){n.d(t,{e:function(){return r}});let r=(0,n(52983).createContext)(null)},7458:function(e,t,n){n.d(t,{S:function(){return g}});var r=n(97458),a=n(83648),o=n(52983),i=n(67310),u=n(1347),l=n(51835),c=n(20534),s=n(52466),d=n(89818);let f=()=>{let{id:e}=(0,s.ph)(),t=(0,l.sJ)((0,d.E)(e)),[n,r]=(0,o.useState)(!1),[a,i]=(0,o.useState)(void 0),[f,m]=(0,o.useState)(void 0),[g,p]=(0,c.iA)(),[w,v]=(0,o.useState)(!1),[b,h]=(0,o.useState)(!1),[k,y]=(0,o.useState)(!1),[C,_]=(0,u.E)({slides:t.length+1,initial:0,loop:!0,defaultAnimation:{duration:300},animationEnded(e){let n=e.track.details.rel;i(null==t?void 0:t[n])},created(){v(!0)}}),S=(0,o.useCallback)(e=>{var n;i(e),null===(n=_.current)||void 0===n||n.moveToIdx(t.findIndex(t=>t===e))},[t,_]),I=(0,o.useCallback)(e=>{var t;null===(t=_.current)||void 0===t||t[e]()},[_]);return(0,o.useEffect)(()=>{p(n)},[n,p]),(0,o.useMemo)(()=>({isAIVariationsLoading:n,setIsAIVariationsLoading:r,selectedAIVariation:a,handleSetSelectedAIVariation:S,prompt:f,setPrompt:m,sliderRef:C,sliderNavigation:I,sliderLoaded:w,hasNsfw:b,setHasNsfw:h,forceAIVariationsButtonTooltip:k,setForceAIVariationsButtonTooltip:y}),[n,a,S,f,C,I,w,b,k])},m=()=>{let[e,t]=(0,c.iA)(),[n,r]=(0,o.useState)(!0),[a,i]=(0,o.useState)(!1),[u,l]=(0,o.useState)(!1),[s,d]=(0,o.useState)(),[f,m]=(0,o.useState)("");return(0,o.useEffect)(()=>{t(a)},[a,t]),(0,o.useMemo)(()=>({isRemoveBackgroundLoading:a,setIsRemoveBackgroundLoading:i,removeBackgroundAnimationEnd:n,setRemoveBackgroundAnimationEnd:r,forceRemoveBackgroundButtonTooltip:u,setForceRemoveBackgroundButtonTooltip:l,imageWithoutBackgroundDimensions:s,setImageWithoutBackgroundDimensions:d,imageUrl:f,setImageUrl:m}),[u,f,s,a,n])},g=e=>{let{children:t}=e,{asPath:n}=(0,a.useRouter)(),[u,l]=(0,o.useState)(),[c,s]=(0,o.useState)("original"),d=m(),g=f(),{setRemoveBackgroundAnimationEnd:p}=d,w=(0,o.useMemo)(()=>({...d,...g,imagePreviewMode:c,setImagePreviewMode:s,editedImageDimensions:u,setEditedImageDimensions:l,isRemoveBackgroundActive:"transparent"===c,isAIVariationsActive:"variations"===c,isEditToolsLoading:d.isRemoveBackgroundLoading||g.isAIVariationsLoading}),[g,u,c,d]);return(0,o.useEffect)(()=>{s("original"),p(!0)},[n,p]),(0,r.jsx)(i.e.Provider,{value:w,children:t})}},62148:function(e,t,n){n.d(t,{Sq:function(){return r.S},J3:function(){return i},TV:function(){return o.T},ql:function(){return u.q}}),n(67310);var r=n(7458),a=n(52983),o=n(93354);let i=()=>{let{isAIVariationsLoading:e,setIsAIVariationsLoading:t,selectedAIVariation:n,handleSetSelectedAIVariation:r,prompt:i,setPrompt:u,sliderRef:l,sliderLoaded:c,sliderNavigation:s,hasNsfw:d,setHasNsfw:f,forceAIVariationsButtonTooltip:m,setForceAIVariationsButtonTooltip:g}=(0,o.T)();return(0,a.useMemo)(()=>({isAIVariationsLoading:e,setIsAIVariationsLoading:t,selectedAIVariation:n,handleSetSelectedAIVariation:r,prompt:i,setPrompt:u,sliderRef:l,sliderLoaded:c,sliderNavigation:s,hasNsfw:d,setHasNsfw:f,forceAIVariationsButtonTooltip:m,setForceAIVariationsButtonTooltip:g}),[e,t,n,r,i,u,l,c,s,d,f,m,g])};var u=n(53294)},93354:function(e,t,n){n.d(t,{T:function(){return o}});var r=n(52983),a=n(67310);let o=()=>{let e=(0,r.useContext)(a.e);if(null===e)throw Error("useEditToolsState must be used within a DetailEditToolsContext");return e}},53294:function(e,t,n){n.d(t,{q:function(){return o}});var r=n(52983),a=n(93354);let o=()=>{let{isRemoveBackgroundLoading:e,setIsRemoveBackgroundLoading:t,removeBackgroundAnimationEnd:n,setRemoveBackgroundAnimationEnd:o,forceRemoveBackgroundButtonTooltip:i,setForceRemoveBackgroundButtonTooltip:u,isRemoveBackgroundActive:l,imageUrl:c,setImageUrl:s}=(0,a.T)();return(0,r.useMemo)(()=>({isRemoveBackgroundLoading:e,setIsRemoveBackgroundLoading:t,removeBackgroundAnimationEnd:n,setRemoveBackgroundAnimationEnd:o,forceRemoveBackgroundButtonTooltip:i,setForceRemoveBackgroundButtonTooltip:u,isRemoveBackgroundActive:l,imageUrl:c,setImageUrl:s}),[e,t,n,o,i,u,l,c,s])}},89818:function(e,t,n){n.d(t,{E:function(){return o}});var r=n(51835);let a=(0,r.cn)({key:"aiVariationsStorageState",default:{}}),o=(0,r.CG)({key:"aiVariationsStorage",get:e=>t=>{let{get:n}=t;return n(a)[e]||[]},set:e=>(t,n)=>{let{set:o,get:i}=t;if(n instanceof r.nY)return;let u=i(a);o(a,{...u,[e]:n})}})},51900:function(e,t,n){n.d(t,{MF:function(){return o},QC:function(){return i},_R:function(){return r},wj:function(){return a}});let r=2e3,a=15,o=["photo","vector"],i="PNG"},56784:function(e,t,n){n.d(t,{Ux:function(){return o},pV:function(){return l},A8:function(){return z},CA:function(){return U}});var r=n(58025),a=n(51900);let o=()=>{let{type:e}=(0,r.ph)();return a.MF.includes(e)};var i=n(52983);let u=async(e,t)=>{if(!e)return;let n=await fetch("/api/ai/remove-background-check?uuid=".concat(e).concat(t?"&isLastCall=1":""));if(200!==n.status)return null;let{image_url:r}=await n.json();return r},l=()=>{let e=(0,i.useRef)(0),t=(0,i.useRef)();return{pollingBackgroundImageUrl:(0,i.useCallback)(n=>new Promise((r,o)=>{t.current=setInterval(async()=>{if(e.current>=a.wj){o(Error("Failed to remove background"));return}e.current+=1;let t=e.current===a.wj,i=await u(n,t);i&&r(i)},a._R)}).finally(()=>{e.current=0,clearInterval(t.current)}),[])}};var c=n(62168),s=n(51835),d=n(52466),f=n(53294),m=n(27288),g=n(59398),p=n(45123),w=n(72833),v=n(42852),b=n(83053),h=n(62148);let k=()=>{let{setForceRemoveBackgroundButtonTooltip:e,setIsRemoveBackgroundLoading:t}=(0,h.ql)(),n=(0,v.J)(),r=(0,w.L)(),a=(0,p._)(),o=(0,g.E)();return(0,i.useCallback)(async i=>{let u=(0,b.L)(),l=await fetch("/api/ai/remove-background",{method:"POST",body:JSON.stringify({resourceId:i,uuid:u,walletId:r,creditsTransaction:!!(a||r)})});if(429===l.status)return e(!0),t(!1),await n(),null;if(!l.ok)throw Error("Failed to remove background");if(200===l.status){let{transactionId:e,walletId:t}=await l.json();return r||o(t),{uuid:u,transactionId:e}}return{uuid:u}},[o,a,e,t,r,n])};var y=n(32748),C=n(51362);let _=()=>{let{onShowToast:e}=(0,C.p)(),{t}=(0,y.$G)("detail"),{setIsRemoveBackgroundLoading:n}=(0,h.ql)();return(0,i.useCallback)(()=>{e({type:"danger",title:t("removeBackground.errorTitle"),message:t("removeBackground.errorMessage"),duration:3e3}),n(!1)},[e,t,n])};var S=n(84891);let I=(e,t)=>{let n=new Image;n.onload=function(){let e=document.createElement("canvas"),r=e.getContext("2d");if(e.width=n.width,e.height=n.height,!r){t(!1);return}r.drawImage(n,0,0);let a=r.getImageData(0,0,e.width,e.height).data;for(let e=0;e<a.length;e+=4)if(0!==a[e+3]){t(!0);return}t(!1)},n.src=e};var T=n(43815),R=n(65508);let E=()=>(0,i.useCallback)(()=>{(0,R.r)("bb6a004a-8f03-4d2a-88fb-a63499d4591a").then(e=>{e.init(),e.logEvent("remove_bg")})},[]),O=()=>{let{id:e}=(0,d.ph)(),{setIsRemoveBackgroundLoading:t}=(0,h.ql)(),n=(0,s.Zl)((0,m.e)(e)),{setImagePreviewMode:r}=(0,h.TV)();return(0,i.useCallback)(e=>{t(!1),r("transparent"),e&&n(e)},[r,t,n])},N=()=>{let e=_(),t=O(),{id:n,premium:r,regularType:a}=(0,d.ph)(),{setImageUrl:o}=(0,h.ql)(),u=(0,S.mS)(),l=E();return(0,i.useCallback)(async i=>{try{o(i);let c=await (0,T.C)(i);I(c,o=>{if(!o){e();return}t(c),u({resourceId:n,isResourcePremium:r,resourceType:a,downloadType:"remove_background"}),l()})}catch(t){e()}},[o,t,u,n,r,a,l,e])},A=()=>{let e=(0,i.useRef)(0),t=(0,i.useRef)(null),n=N(),r=_(),o=(0,v.J)();return(0,i.useCallback)(i=>{t.current=setInterval(async()=>{if(e.current>=a.wj){t.current&&clearInterval(t.current),r();return}e.current+=1;let l=e.current===a.wj,c=await u(i,l);c&&(n(c),await o(),t.current&&clearInterval(t.current))},a._R)},[n,r,o])},L=()=>{let{id:e,premium:t,regularType:n}=(0,d.ph)(),{setIsRemoveBackgroundLoading:r}=(0,f.q)(),a=(0,s.sJ)((0,m.e)(e)),o=_(),u=A(),l=O(),g=(0,c.PN)(),p=k(),w=(0,i.useCallback)(()=>g({event:"ga4event",event_name:"background_remove",category:n,file_id:e,license:t?"premium":"free",location:"resource_detail"}),[e,t,n,g]);return(0,i.useCallback)(async()=>{if(r(!0),a){l();return}try{w();let t=await p(e);if(!t){r(!1);return}let{uuid:n}=t;u(n)}catch(e){o()}},[r,a,l,o,w,p,e,u])};var j=n(21639),x=n(73725);let z=()=>{let{id:e,name:t,author:n,premium:r,regularType:o,isAIGenerated:u,dimensions:{width:l=0,height:c=0}={}}=(0,d.ph)(),{downloadCopyImageToClipboard:f}=(0,x.tS)(),g=(0,s.sJ)((0,m.e)(e)),p=(0,j.TH)({file_extension:a.QC.toLowerCase(),file_name:t,file_id:e,license:r?"premium":"free",resolution:"original",style:"na",author_name:n.name,category:u?"ai_image":o,action:"copy",location:"resource_detail"});return(0,i.useCallback)(()=>{f({url:g,width:l,height:c}),p()},[f,c,g,p,l])},U=()=>{let e=L(),{hideAttribution:t}=(0,d.ph)(),{isRemoveBackgroundActive:n,setRemoveBackgroundAnimationEnd:r}=(0,h.ql)(),{setImagePreviewMode:a}=(0,h.TV)();return(0,i.useCallback)(async()=>{r(!1),t(),n?a("original"):await e()},[t,n,e,a,r])}},43815:function(e,t,n){n.d(t,{C:function(){return r}});let r=e=>fetch(e).then(e=>e.blob()).then(e=>new Promise(t=>{let n=new FileReader;n.onload=function(){t(this.result)},n.readAsDataURL(e)}))},27288:function(e,t,n){n.d(t,{e:function(){return o}});var r=n(51835);let a=(0,r.cn)({key:"removeBackgroundStorageState",default:{}}),o=(0,r.CG)({key:"removeBackgroundStorage",get:e=>t=>{let{get:n}=t;return n(a)[e]},set:e=>(t,n)=>{let{set:o,get:i}=t;if(n instanceof r.nY)return;let u=i(a);o(a,{...u,[e]:n})}});(0,r.cn)({key:"isRemoveBackgroundOnboardingEnabledState",default:!1})},3036:function(e,t,n){n.d(t,{f:function(){return i},r:function(){return u}});var r=n(97458),a=n(52983);let o=(0,a.createContext)(null),i=e=>{let{children:t,shouldTrackingLog:n}=e,i=(0,a.useMemo)(()=>({shouldTrackingLog:n}),[n]);return(0,r.jsx)(o.Provider,{value:i,children:t})},u=()=>(0,a.useContext)(o)||{shouldTrackingLog:!0}},3704:function(e,t,n){n.d(t,{H:function(){return a}});let r=e=>{let{resource:t,file:n,option:r,size:a,action:o}=e,i=new URLSearchParams;return i.set("resource","".concat(t)),n&&r?(i.set("file",n),i.set("option","".concat(r))):a&&i.set("size","".concat(a)),o&&i.set("action",o),i.toString()},a=async e=>{let t=r(e),n=await fetch("/api/regular/download?".concat(t));return n.ok?{success:!0,data:await n.json()}:429===n.status?{success:!1,data:"DOWNLOAD_LIMIT_REACHED",metadata:"/download-limit"}:401===n.status||403===n.status||405===n.status?{success:!1,data:"AUTHENTICATION_ERROR"}:404===n.status?{success:!1,data:"NOT_FOUND"}:{success:!1,data:"UNKNOWN_ERROR"}}},73725:function(e,t,n){n.d(t,{iJ:function(){return r.i},Zd:function(){return i},tS:function(){return u.t}});var r=n(83741),a=n(42852),o=n(52983);let i=e=>{let{isDownloading:t,handleDownload:n}=(0,r.i)(e),i=(0,a.J)();return{isDownloading:t,onClick:(0,o.useCallback)(async e=>{e.preventDefault();let t=e.currentTarget;if(!t)return;let r=await n();if(!r)return;let a=r.url;r.filename&&(t.download=r.filename,a+="".concat(r.url.includes("?")?"&":"?","filename=").concat(r.filename)),t.href=a,t.click(),i()},[n,i])}};var u=n(78683)},83741:function(e,t,n){n.d(t,{i:function(){return I}});var r=n(16782),a=n(52983),o=n(21639),i=n(50317),u=n(4439),l=n(95102);let c=(e,t)=>t||("photo"===e?"jpg":"zip");var s=n(52466),d=n(3036),f=n(3704),m=n(32565),g=n(36823),p=n(83272),w=n(72118),v=n(1850),b=n(87065);let h=v.z.enum(["download","copy","edit","prompt"]);v.z.object({resource:v.z.coerce.number(),file:b.ru.optional(),option:v.z.coerce.number().optional(),size:v.z.coerce.number().optional(),action:h.optional()}),v.z.object({data:v.z.object({filename:v.z.string(),url:v.z.string(),prompt:v.z.string().optional(),signed_url:v.z.string().optional()})}).transform(e=>{let{data:t}=e;return t}).transform(e=>{let{signed_url:t,...n}=e;return{...n,signedUrl:t}});let k=v.z.array(v.z.string()),y=new Date(new Date().getTime()+48e4),C=w.Z.withConverter({write:e=>e}),_=e=>{try{let t=C.get(e);if(!t)return[];return k.parse(JSON.parse(t))}catch(e){return[]}},S=()=>{let e=(0,p.I)(),t=(0,g.b)();return(0,a.useCallback)(n=>{if(!e)return;let r="".concat("ck_items_").concat(e),a=_(r),o="".concat(n);if(!a.includes(o)){let e=JSON.stringify([...a,o]);C.set(r,e,{path:"/",domain:t,expires:y})}},[e,t])},I=e=>{let{resource:t,file:n,action:g="download",location:p="resource_detail",option:w,size:v,isRemoveBackgroundActive:b=!1,showAttributionModal:h=!0}=e,{id:k,name:y,author:C,premium:_,regularType:I,isAIGenerated:T}=t,[R,E]=(0,a.useState)(!1),{isUserWinback:O,showWinbackModal:N}=(0,i.lK)(),{showAttribution:A}=(0,s.tc)(),L=S(),j=(0,m.b)(),x=(0,u.mS)(),{shouldTrackingLog:z}=(0,d.r)(),{showDeviceBlockedModal:U,isDeviceBlocked:M}=(0,r.qx)(),P=(0,o.TH)({file_extension:c(I,n),file_name:y,file_id:k,license:_?"premium":"free",resolution:v?l.w8[v]:"original",style:"na",author_name:C.name,category:T?"ai_image":I,action:"prompt"===g?"view_prompt":g,location:p});return{handleDownload:(0,a.useCallback)(async()=>{if(M){U();return}if(O){N();return}E(!0);let e=await (0,f.H)({resource:k,size:v?2e3:void 0,action:g,file:n,option:w});if(e.success)return h&&A&&A(),E(!1),L(k),z&&x({resourceId:k,isResourcePremium:_,resourceType:I,downloadType:b&&"edit"===g?l.QN:g}),P(),e.data;"prompt"!==g&&j(e),E(!1)},[M,O,k,v,g,n,w,U,N,h,A,L,z,P,b,x,_,I,j]),isDownloading:R}}},32565:function(e,t,n){n.d(t,{b:function(){return i}});var r=n(32748),a=n(52983),o=n(51362);let i=()=>{let{t:e}=(0,r.$G)("error"),{onShowToast:t}=(0,o.p)();return(0,a.useCallback)(n=>{if("DOWNLOAD_LIMIT_REACHED"===n.data&&"metadata"in n){window.location.href=n.metadata;return}if("AUTHENTICATION_ERROR"===n.data){window.location.href="/oauth-logout";return}"NOT_FOUND"===n.data&&t({type:"danger",message:e("notFound")}),"UNKNOWN_ERROR"===n.data&&t({type:"danger",message:e("unknown")})},[t,e])}},78683:function(e,t,n){n.d(t,{t:function(){return d}});var r=n(59190),a=n(59813),o=n(14409),i=n(32748),u=n(52983),l=n(7489),c=n(51362);let s=(e,t)=>{let n=document.createElement("a");t&&(n.download=t),n.href=e,n.click(),setTimeout(function(){n.remove()},200)},d=()=>{let{t:e}=(0,i.$G)(["detail","common"]),[t,n]=(0,u.useState)(!1),{onShowToast:d}=(0,c.p)(),{setConfirm:f}=(0,l.N)(),m=(0,u.useCallback)(async t=>{try{(0,o.C)()||d({type:"danger",message:e("clipboardNotSupported")}),n(!0),await navigator.clipboard.write([t]),d({type:"success",title:e("detail:copyImageClipboard"),message:e("common:copiedsuccessfully"),testId:"notification-copied-successfully"})}catch(e){d()}finally{n(!1)}},[d,e]),g=(0,u.useCallback)(async(e,t,n,o,i,u)=>{let l="clipboard"===o,c=l?e.naturalWidth:t,d=l?e.naturalHeight:n,g=document.createElement("canvas");g.width=c,g.height=d;let p=g.getContext("2d");p&&(p.drawImage(e,0,0,c,d),g.toBlob(async e=>{let t;if(e){if(l){if((0,a.gn)()||r.G6){t=new ClipboardItem({[e.type]:Promise.resolve(e)}),f(()=>{m(t)});return}m(t=new ClipboardItem({[e.type]:e}))}else{let t=window.URL.createObjectURL(e);s(t,u),window.URL.revokeObjectURL(t)}}},"image/".concat(i),1))},[m,f]);return{downloadImageSize:(0,u.useCallback)(async e=>{let{url:t,filename:n,width:r,height:a}=e;try{let e=new Image;e.src=t,e.crossOrigin="Anonymous",e.onload=()=>{g(e,r,a,"download","jpeg",n)},e.onerror=()=>d()}catch(e){d()}},[g,d]),downloadCopyImageToClipboard:(0,u.useCallback)(async e=>{let{url:t,width:r,height:a}=e;try{n(!0);let e=new Image;e.src=t,e.crossOrigin="Anonymous",e.onload=()=>{g(e,r,a,"clipboard","png")},e.onerror=()=>{n(!1),d()}}catch(e){n(!1),d()}},[d,g]),isCopying:t}}},59813:function(e,t,n){n.d(t,{gn:function(){return i},eE:function(){return o},Xe:function(){return u}});let r=()=>{if("undefined"==typeof navigator)return"Unknown";let e=navigator.userAgent,t=navigator.platform,n={MacOS:["Macintosh","MacIntel","MacPPC","Mac68K"].includes(t),iOS:["iPhone","iPad","iPod"].includes(t),Windows:["Win32","Win64","Windows","WinCE"].includes(t),Android:/Android/.test(e),Linux:/Linux/.test(t),Unknown:!0};return Object.keys(n).find(e=>n[e])||"Unknown"},a=r(),o=()=>"MacOS"===a,i=()=>"iOS"===a,u=()=>i()||"Android"===r()}}]);